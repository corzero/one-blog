(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0c524382"],{"199e":function(e,t,n){"use strict";var r=n("abd5"),a=n.n(r);a.a},abd5:function(e,t,n){},bd113:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"storage-bar"},[n("el-dropdown",[n("el-button",{attrs:{type:"primary",size:"small"}},[e._v("上传文件"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{staticClass:"upload-type"},[n("input",{ref:"uploadFile",attrs:{type:"file",multiple:"multiplt"},on:{change:function(t){return e.handleUploadFiles(t.target)}}}),e._v("\n          上传文件\n        ")]),e._v(" "),n("el-dropdown-item",{staticClass:"upload-type"},[n("input",{ref:"uploadFolder",attrs:{type:"file",multiple:"multiplt",webkitdirectory:""},on:{change:function(t){return e.handleUploadFolder(t.target)}}}),e._v("\n          上传文件夹\n        ")])],1)],1),e._v(" "),n("div",{staticStyle:{"margin-left":"12px",display:"inline-block"}},[n("el-button",{attrs:{icon:"el-icon-folder-add",size:"small"},on:{click:e.createFolder}},[e._v("新建文件夹")]),e._v(" "),n("el-button",{attrs:{icon:"el-icon-download",size:"small"}},[e._v("离线下载")]),e._v(" "),n("el-button-group",{directives:[{name:"show",rawName:"v-show",value:e.selectArray.length,expression:"selectArray.length"}],staticStyle:{"margin-left":"10px"}},[n("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-download"}}),e._v(" "),n("el-button",{attrs:{type:"warning",size:"small",icon:"el-icon-share"}}),e._v(" "),n("el-button",{attrs:{type:"danger",size:"small",icon:"el-icon-delete"},on:{click:function(t){return e.handleDelete()}}})],1)],1)],1),e._v(" "),n("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},e._l(e.breadList,function(t){return n("el-breadcrumb-item",{key:t._id,staticStyle:{cursor:"pointer"},nativeOn:{click:function(n){return e.changeFolder(t._id)}}},[e._v(e._s(t.fName))])}),1),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.mergeList,"tooltip-effect":"dark"},on:{"selection-change":function(t){return e.selectArray=t}}},[n("el-table-column",{attrs:{type:"selection",width:"50"}}),e._v(" "),n("el-table-column",{attrs:{label:"文件（夹）名",width:"800","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[n("svg-icon",{style:{width:"2em",height:"2em"},attrs:{"icon-class":t.row.type}}),e._v(" "),e.edit._id==t.row._id?n("el-input",{staticStyle:{position:"absolute","max-width":"200px"},attrs:{size:"small"},model:{value:e.edit.name,callback:function(t){e.$set(e.edit,"name",t)},expression:"edit.name"}}):"folder"===t.row.type?n("el-button",{staticClass:"file-name",staticStyle:{padding:"0px"},attrs:{type:"text"},nativeOn:{click:function(n){return e.changeFolder(t.row._id)}}},[e._v(e._s(t.row.fName))]):n("span",{staticClass:"file-name"},[e._v(e._s(t.row.fName))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"大小",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(e.sizeTransform(t.row.size)))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"更新时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.meta&&t.row.meta.updatedAt?e.$moment(t.row.meta.updatedAt).format("YYYY-MM-DD HH:mm"):"--"))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.edit._id===t.row._id?n("div",[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"确定",placement:"top"}},[n("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-check",circle:""},on:{click:function(t){return e.saveEdit()}}})],1),e._v(" "),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"取消",placement:"top"}},[n("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-close",circle:""},on:{click:function(t){return e.cancelEdit()}}})],1)],1):n("div",[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"重命名",placement:"top"}},[n("el-button",{attrs:{size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(n){return e.handleRename(t.row)}}})],1),e._v(" "),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"删除",placement:"top"}},[n("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(n){return e.handleDelete([t.row._id],t.row.isFolder)}}})],1),e._v(" "),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"分享",placement:"top"}},[n("el-button",{attrs:{type:"warning",size:"mini",icon:"el-icon-share",circle:""}})],1),e._v(" "),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"下载",placement:"top"}},[n("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-download",circle:""}})],1)],1)]}}])})],1),e._v(" "),n("el-pagination",{staticClass:"pagination",attrs:{background:"",layout:"prev, pager, next",total:e.total},on:{"current-change":e.getTypeList}}),e._v(" "),n("el-card",{directives:[{name:"show",rawName:"v-show",value:e.uploadList.length&&e.isShow,expression:"uploadList.length&&isShow"}],staticClass:"upload-box",attrs:{"body-style":{padding:"10px"}}},[n("div",{staticClass:"clearfix",staticStyle:{margin:"-8px"},attrs:{slot:"header"},slot:"header"},[n("span",[e._v("正在上传")]),e._v(" "),n("div",{staticClass:"upload-operate"},[n("el-button",{staticStyle:{padding:"3px 5px"},attrs:{type:"text",icon:"el-icon-minus"}}),e._v(" "),n("el-button",{staticStyle:{padding:"3px 5px"},attrs:{type:"text",icon:"el-icon-close"},on:{click:function(t){e.isShow=!1}}})],1)]),e._v(" "),e._l(e.uploadList,function(t,r){return n("div",{key:t.name+r,staticClass:"upload-item clearfix"},[n("div",{staticClass:"item-box upload-icon"},[n("svg-icon",{style:{width:"1.2em",height:"1.2em"},attrs:{"icon-class":t.type||"folder"}})],1),e._v(" "),n("div",{staticClass:"item-box upload-name"},[e._v(e._s(t.name))]),e._v(" "),n("div",{staticClass:"item-box upload-size"},[e._v(e._s(e.sizeTransform(t.size)))]),e._v(" "),n("div",{staticClass:"item-box upload-path"},[e._v(e._s(t.path))]),e._v(" "),n("div",{staticClass:"item-box upload-status"},[e._v(e._s(e.statusType(t.status)))]),e._v(" "),n("div",{staticClass:"item-box upload-control"},[n("el-button",{directives:[{name:"show",rawName:"v-show",value:1==t.status,expression:"e.status==1"}],attrs:{type:"text",icon:"el-icon-video-pause"},on:{click:function(t){return e.handlerPause(r)}}}),e._v(" "),n("el-button",{directives:[{name:"show",rawName:"v-show",value:3==t.status,expression:"e.status==3"}],attrs:{type:"text",icon:"el-icon-upload2"},on:{click:function(t){return e.handlerContinue(r)}}}),e._v(" "),n("el-button",{directives:[{name:"show",rawName:"v-show",value:2!=t.status,expression:"e.status!=2"}],attrs:{type:"text",icon:"el-icon-close"},on:{click:function(t){return e.handlerCancel(r)}}})],1),e._v(" "),n("el-progress",{staticClass:"upload-progress",attrs:{percentage:t.percent,color:"#67c23a","stroke-width":1,format:function(){return""}}})],1)})],2)],1)},a=[],i=(n("a481"),n("5df3"),n("7f7f"),n("ac4d"),n("8a81"),n("ac6a"),n("20d6"),n("96cf"),n("3b8d"));n("c5f6"),n("28a5"),n("6b54"),n("7618");function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/folder/gi.test(e)?"folder":/video/gi.test(e)?"movie":/audio/gi.test(e)?"mp3":/image/gi.test(e)?"image":/pdf/gi.test(e)?"pdf":/excel|xls|xlsx/gi.test(e)?"excel":/word/gi.test(e)?"word":/powerpoint/gi.test(e)?"ppt":/plain/gi.test(e)?"txt":/htm|html|css|javascript|json/gi.test(e)?"code":/msdownload/gi.test(e)?"exe":/zip|rar|gzip|tgz/gi.test(e)?"zip":"other"}var o=n("69a0"),c=n.n(o),l=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,u=10485760,p=function(e,t,n,r){var a=r*n,i=a+n>=e.size?e.size:a+n;t.readAsArrayBuffer(l.call(e,a,i))},d=function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var r=Math.ceil(t.size/u),a=0,i=new c.a.ArrayBuffer,s=new FileReader;s.onload=function(n){if(i.append(n.target.result),a+=1,a<r)p(t,s,u,a);else{console.log("finished loading");var o=i.end(),l=new c.a;l.append(o),l.append(t.name);var d=l.end();e(d)}},s.onerror=function(){return console.warn("文件读取失败！")},s.onloadend=function(e){return console.log("ahhhhhhhhhh",e)},p(t,s,u,a)}).catch(function(e){return console.log(e)}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t,n,r){var a,i,s,o,c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=[],i=Math.ceil(t.size/u),console.log("分块个数",i),e.next=5,d(t);case 5:for(s=e.sent,console.log("文件hash",s),o=function(e){var o=e*u,c=Math.min(t.size,o+u),p=new FormData;p.append("file",l.call(t,o,c)),p.append("name",t.name),p.append("total",i),p.append("index",e),p.append("size",t.size),p.append("hash",s);var d={onUploadProgress:function(a){n&&n(r,(e+1)/i,a.loaded),console.log("处理上传的进度",i,e,a,t)}};a.push({form:p,option:d})},c=0;c<i;c++)o(c);return e.abrupt("return",{parmasList:a,total:i,hash:s});case 10:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),h=f,m=n("365c"),v=m.storage,g=n("11c1"),w={name:"StorageIndex",props:{type:{type:Number,required:!0,default:function(){return-1}}},data:function(){return{loading:!1,isShow:!1,breadList:[],selectArray:[],query:"",total:0,edit:{_id:null,name:null,suffix:null},folder:{_id:"",name:"",path:""},mergeList:[],uploadList:[],taskList:{}}},created:function(){var e=this.$store.getters.baseFolder;this.queryFolder(e),this.getTypeList(this.type,e)},methods:{queryFolder:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,v.queryFolder(t);case 2:n=e.sent,200===n.code&&(this.folder=Object.assign({},n.data),this.breadList.push(n.data));case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),getTypeList:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,v.getList({type:t,fid:n});case 2:r=e.sent,200===r.code&&(this.mergeList=r.data);case 4:case"end":return e.stop()}},e,this)}));function t(t,n){return e.apply(this,arguments)}return t}(),changeFolder:function(e){if(this.folder._id!==e){console.log("index",this.folder._id,e,this.breadList.findIndex(function(t){return t._id===e}));var t=this.breadList.findIndex(function(t){return t._id===e});-1!==t&&this.breadList.splice(t),this.queryFolder(e),this.getTypeList(this.type,e)}},handleUploadFiles:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var n,r,a,o,c,l,u=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(t.files),!t.files.length){e.next=35;break}e.prev=2,n=!0,r=!1,a=void 0,e.prev=6,o=regeneratorRuntime.mark(function e(){var t,n,r,a,o,c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=l.value,n={id:g.v1(),name:t.name,type:s(t.type),size:t.size,path:u.folder.name,status:0,percent:0},u.uploadList.push(n),u.isShow=!0,e.next=6,h(t,u.progress,n.id).catch(function(e){return console.error(e)});case 6:return r=e.sent,a=r.parmasList,o=r.total,c=r.hash,u.taskList[n.id]=a,console.log(a),e.next=14,Promise.all(a.map(function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,v.upload(t.form,t.option);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())).catch(function(e){return console.error(e)});case 14:return e.next=16,v.merge({parentFolder:u.folder,size:t.size,name:t.name,total:o,hash:c,type:s(t.type)});case 16:u.uploadList=u.uploadList.map(function(e){return e.id===n.id?Object.assign(e,{status:2,percent:100}):e});case 17:case"end":return e.stop()}},e)}),c=t.files[Symbol.iterator]();case 9:if(n=(l=c.next()).done){e.next=14;break}return e.delegateYield(o(),"t0",11);case 11:n=!0,e.next=9;break;case 14:e.next=20;break;case 16:e.prev=16,e.t1=e["catch"](6),r=!0,a=e.t1;case 20:e.prev=20,e.prev=21,n||null==c.return||c.return();case 23:if(e.prev=23,!r){e.next=26;break}throw a;case 26:return e.finish(23);case 27:return e.finish(20);case 28:this.$message.success("上传成功"),e.next=35;break;case 31:e.prev=31,e.t2=e["catch"](2),console.error(e.t2),this.$message.error("上传失败");case 35:t=null,this.getTypeList(this.type,this.folder._id);case 37:case"end":return e.stop()}},e,this,[[2,31],[6,16,20,28],[21,,23,27]])}));function t(t){return e.apply(this,arguments)}return t}(),handleUploadFolder:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var n,r,a,s,o,c,l=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(t.files),!t.files.length){e.next=27;break}n=!0,r=!1,a=void 0,e.prev=5,s=regeneratorRuntime.mark(function e(){var t,n,r,a,s,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=c.value,n={id:g.v1(),name:t.name,type:t.type,size:t.size,path:l.folder.name,status:0,percent:0},l.uploadList.push(n),l.isShow=!0,e.next=6,h(t,l.progress,n.id).catch(function(e){return console.error(e)});case 6:return r=e.sent,a=r.parmasList,s=r.total,o=r.hash,l.taskList[n.id]=a,console.log(a),e.next=14,Promise.all(a.map(function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,v.upload(t.form,t.option);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())).catch(function(e){return console.error(e)});case 14:return e.next=16,v.merge({size:t.size,name:t.name,total:s,hash:o,type:0});case 16:l.uploadList=l.uploadList.map(function(e){return e.id===n.id?Object.assign(e,{status:2,percent:100}):e});case 17:case"end":return e.stop()}},e)}),o=t.files[Symbol.iterator]();case 8:if(n=(c=o.next()).done){e.next=13;break}return e.delegateYield(s(),"t0",10);case 10:n=!0,e.next=8;break;case 13:e.next=19;break;case 15:e.prev=15,e.t1=e["catch"](5),r=!0,a=e.t1;case 19:e.prev=19,e.prev=20,n||null==o.return||o.return();case 22:if(e.prev=22,!r){e.next=25;break}throw a;case 25:return e.finish(22);case 26:return e.finish(19);case 27:t=null;case 28:case"end":return e.stop()}},e,null,[[5,15,19,27],[20,,22,26]])}));function t(t){return e.apply(this,arguments)}return t}(),createFolder:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$prompt("请输入文件名","新建文件夹",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^[\u4e00-\u9fa5|A-Za-z|0-9|_]{1,30}$/,inputErrorMessage:"文件名格式错误"}).catch(function(e){console.log("取消")});case 2:if(t=e.sent,console.log("value",t),!t||!t.value){e.next=10;break}return n={path:this.folder.path,parentId:this.folder._id,fName:t.value},console.log("params",n),e.next=9,v.createFolder(n).catch(function(e){return console.error(e)});case 9:this.getTypeList(this.type,this.folder._id);case 10:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),handleShare:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),handleDelete:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var n,r,a=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]&&a[1],t||(t=this.selectArray.map(function(e){return e._id})),e.next=4,v.setTrash(t,n);case 4:r=e.sent,200===r.code&&this.getTypeList(this.type,this.folder._id);case 6:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),handleremove:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),handlerPause:function(){},handlerContinue:function(){},handlerCancel:function(e){this.uploadList.splice(e,1)},handleRename:function(e){var t=e._id,n=e.fName,r=/\.[^\.]+$/.exec(n);this.edit={_id:t,name:n.replace(/\.[^\.]+$/,""),suffix:r}},saveEdit:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t={fName:this.edit.name+this.edit.suffix,_id:this.edit._id},e.next=3,v.rename(t);case 3:this.cancelEdit();case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),handleSelect:function(){},cancelEdit:function(){this.edit={_id:null,name:null,suffix:null}},statusType:function(e){switch(e){case 0:e="正在校验";break;case 1:e="正在上传";break;case 2:e="上传成功";break;case 3:e="暂停上传";break;case 4:e="取消上传";break;default:e="--"}return e},sizeTransform:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return 0===e?"--":e<1024?e+"Byte":e/1024<1024?parseFloat(e/1024).toFixed(2)+"KB":e/1024/1024<1024?parseFloat(e/1024/1024).toFixed(2)+"MB":parseFloat(e/1024/1024/1024).toFixed(2)+"GB"},progress:function(e,t,n){this.uploadList.map,this.uploadList=this.uploadList.map(function(n){return n.id===e?Object.assign(n,{status:1,percent:100*t}):n})}}},b=w,y=(n("199e"),n("2877")),x=Object(y["a"])(b,r,a,!1,null,null,null);t["default"]=x.exports}}]);